<!--
 * @Author: your name
 * @Date: 2021-11-03 10:58:25
 * @LastEditTime: 2021-11-03 10:59:26
 * @LastEditors: your name
 * @Description: In User Settings Edit
 * @FilePath: /handwritingboard/Users/yangjz0/workspace/phpweb/mutation-observer/index2.html
-->
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    body {
      padding: 0 20px;
      font-size: 1.2em;
    }

    .list {
      min-height: 176px;
    }

    button {
      margin: 3px;
    }
  </style>
</head>

<body>
  <h2>MutationObserver Example - childList with subtree</h2>

  <p>This page uses the MutationObserver API to watch for changes to the DOM tree. In this case, the MutationObserver is
    looking for child elements to be changed on the targeted element and the <code>subtree</code> option is set to
    <code>true</code>. This means the MutationObserver will detect changes to all nodes, not just the immediate children
    of the targeted element.
  </p>

  <ul id="myList" class="list">
    <li>Apples</li>
    <li>Oranges
      <ul id="nestedList" class="nestedList">
        <li>Mandarins</li>
        <li>Tangerines</li>
        <li>Pomelos</li>
        <li class="nestedchild">Tangelos</li>
      </ul>
    </li>
    <li>Bananas</li>
    <li class="child">Peaches</li>
  </ul>

  <p><button class="btnStart">Start Observing for Mutations</button> <button class="btnStop" disabled>Stop Observing for
      Mutations</button></p>

  <p><button class="btnChild">Add/Remove Child from Main List</button> <button class="btnSubtree">Add/Remove Child from
      Nested List</button></p>

  <script>
    let mList = document.getElementById('myList'),
      nestedList = document.getElementById('nestedList'),
      btnChild = document.querySelector('.btnChild'),
      btnStart = document.querySelector('.btnStart'),
      btnStop = document.querySelector('.btnStop'),
      btnSubtree = document.querySelector('.btnSubtree'),
      options = {
        childList: true,
        subtree: true
      },
      observer = new MutationObserver(mCallback);

    function mCallback(mutations) {
      for (let mutation of mutations) {
        if (mutation.type === 'childList') {
          console.error('Mutation Detected: A child element has been added or removed.');
        }
      }
    }

    function doLogAndBtn(msg) {
      console.error(msg);
      btnStart.disabled = !btnStart.disabled;
      btnStop.disabled = !btnStop.disabled;
    }

    btnStart.addEventListener('click', function () {
      observer.observe(mList, options);
      doLogAndBtn('Observing for mutations: STARTED');
    }, false);

    btnChild.addEventListener('click', function () {
      if (document.querySelector('.child')) {
        mList.removeChild(document.querySelector('.child'));
      } else {
        mList.insertAdjacentHTML('beforeend', '\n<li class="child">Peaches</li>');
      }
    }, false);

    btnSubtree.addEventListener('click', function () {
      if (document.querySelector('.nestedchild')) {
        nestedList.removeChild(document.querySelector('.nestedchild'));
      } else {
        nestedList.insertAdjacentHTML('beforeend', '\n<li class="nestedchild">Tangelos</li>');
      }
    }, false);

    btnStop.addEventListener('click', function () {
      observer.disconnect();
      doLogAndBtn('Observing for mutations: STOPPED');
    }, false);
  </script>
</body>

</html>