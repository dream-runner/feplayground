<!--
    THIS EXAMPLE WAS DOWNLOADED FROM https://echarts.apache.org/examples/zh/editor.html?c=custom-profile
-->
<!DOCTYPE html>
<html style="height: 100%">

<head>
  <meta charset="utf-8">
</head>

<body style="height: 100%; margin: 0">
  <div id="container" style="height: 100%"></div>

  <script type="text/javascript" src="./echarts.min.js"></script>
  <!-- Uncomment this line if you want to dataTool extension
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@{{version}}/dist/extension/dataTool.min.js"></script>
        -->
  <!-- Uncomment this line if you want to use gl extension
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-gl@2/dist/echarts-gl.min.js"></script>
        -->
  <!-- Uncomment this line if you want to echarts-stat extension
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-stat@latest/dist/ecStat.min.js"></script>
        -->
  <!-- Uncomment this line if you want to use map
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@{{version}}/map/js/china.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@{{version}}/map/js/world.js"></script>
        -->
  <!-- Uncomment these two lines if you want to use bmap extension
        <script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=<Your Key Here>"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@{{version}}/dist/extension/bmap.min.js"></script>
        -->

  <script type="text/javascript">
    var container = document.getElementById("container");
    function paintFrame (paintOptions = {}) {
      var dom = document.createElement('div')
      dom.style.height = paintOptions.frameHeight || '500px'
      container.appendChild(dom)
      var myChart = echarts.init(dom);
      var app = {};
  
      var option;
  
  
  
      var data = [];
      var dataCount = 10;
      var startTime = +new Date();
      var categories = ['categoryA', 'categoryB', 'categoryC'];
      var types = [{
          name: 'JS Heap',
          color: '#7b9ce1'
        },
        {
          name: 'Documents',
          color: '#bd6d6c'
        },
        {
          name: 'Nodes',
          color: '#75d874'
        },
        {
          name: 'Listeners',
          color: '#e0bc78'
        },
        {
          name: 'GPU Memory',
          color: '#dc77dc'
        },
        {
          name: 'GPU',
          color: '#72b362'
        }
      ];
      // Generate mock data
      categories.forEach(function (category, index) {
        var baseTime = startTime;
        for (var i = 0; i < dataCount; i++) {
          var typeItem = types[Math.round(Math.random() * (types.length - 1))];
          var duration = Math.round(Math.random() * 10000);
          data.push({
            name: typeItem.name,
            value: [index, baseTime, (baseTime += duration), duration],
            itemStyle: {
              normal: {
                color: typeItem.color
              }
            }
          });
          baseTime += Math.round(Math.random() * 2000);
        }
      });
  
      function renderItem(params, api) {
        var categoryIndex = api.value(0);
        var start = api.coord([api.value(1), categoryIndex]);
        var end = api.coord([api.value(2), categoryIndex]);
        var height = api.size([0, 1])[1] * 0.6;
        var rectShape = echarts.graphic.clipRectByRect({
          x: start[0],
          y: start[1] - height / 2,
          width: end[0] - start[0],
          height: height
        }, {
          x: params.coordSys.x,
          y: params.coordSys.y,
          width: params.coordSys.width,
          height: params.coordSys.height
        });
        return (
          rectShape && {
            type: 'rect',
            transition: ['shape'],
            shape: rectShape,
            style: api.style({
              fill: '#f00',
              text: 'shit bro'
            })
          }
        );
      }
      option = {
        tooltip: {
          formatter: function (params) {
            // return (
            //   `
            //   <ul>
            //     <li>shit bro</li>
            //     <li>shit bro</li>
            //   </ul>
            //   `
            // )
            return params.marker + params.name + ': ' + params.value[3] + ' ms';
          }
        },
        title: {
          text: 'Profile',
          left: 'center'
        },
        dataZoom: [{
            type: 'slider',
            filterMode: 'weakFilter',
            showDataShadow: false,
            top: 400,
            labelFormatter: ''
          },
          {
            type: 'inside',
            filterMode: 'weakFilter'
          }
        ],
        grid: {
          height: 300
        },
        xAxis: {
          position: 'top',
          min: startTime,
          scale: true,
          splitLine: {
            interval: 5
          },
          axisLabel: {
            formatter: function (val) {
              return Math.max(0, val - startTime) + ' ms';
            }
          }
        },
        yAxis: {
          data: categories
        },
        series: [{
          type: 'custom',
          renderItem: renderItem,
          itemStyle: {
            opacity: 0.8
          },
          encode: {
            x: [1, 2],
            y: 0
          },
          data: data
        }]
      };
  
      if (option && typeof option === 'object') {
        myChart.setOption(option);
        myChart.on('click', function (data) {
          debugger
        })
      }
    }
  </script>
  <script>
    var frames = [1, 2]
    frames.forEach(frame => {
      paintFrame()
    })
  </script>
</body>

</html>